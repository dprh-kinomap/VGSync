<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>OpenLayers – Directions + Speed Input + Keep old logic</title>

  <!-- OpenLayers (CDN) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@7.3.0/ol.css" />
  <script src="https://cdn.jsdelivr.net/npm/ol@7.3.0/dist/ol.js"></script>

  <!-- QWebChannel (für QtWebEngine) -->
  <script src="qrc:///qtwebchannel/qwebchannel.js"></script>

  <style>
    html, body {
      margin: 0; 
      padding: 0; 
      width: 100%;
      height: 100%;
      overflow: hidden;
      background-color: #f0f0f0;
    }
    #map {
      position: absolute;
      top: 0; 
      left: 0;
      width: 100%;
      height: 100%;
    }

    /* Button unten links => 4 Modi (OSM, MapTiler, Mapbox, Bing) */
    #mapViewBtn {
      position: absolute;
      bottom: 10px;
      left: 10px;
      z-index: 9999;
      opacity: 0.8;
      background-color: #ccc;
      border: none;
      padding: 4px 8px;
      cursor: pointer;
      font-size: 0.9rem;
    }
    #moveBtn {
      position: absolute;
      top: 10px;
      right: 80px;
      z-index: 9999;
      background-color: rgba(200,200,200,0.5); 
      border: 1px solid #777;
      padding: 4px 8px;
      cursor: pointer;
      font-size: 0.9rem;
    }
    #btnSyncNoArg {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 9999;
      background-color: rgba(200,200,200,0.5); 
      border: 1px solid #777;
      padding: 4px 8px;
      cursor: pointer;
      font-size: 0.9rem;
    }
    #btnNewPoint {
      position: absolute;
      top: 10px;
      right: 160px;
      z-index: 9999;
      background-color: rgba(200,200,200,0.5);
      border: 1px solid #777;
      padding: 4px 8px;
      cursor: pointer;
      font-size: 0.9rem;
    }

    /* Directions-Button */
    #btnDirections {
      position: absolute;
      top: 10px;
      right: 300px;
      z-index: 9999;
      background-color: rgba(200,200,200,0.5);
      border: 1px solid #777;
      padding: 4px 8px;
      cursor: pointer;
      font-size: 0.9rem;
    }

    /* NEU: Profil-Button => Bike/Foot/Car */
    #btnProfile {
      position: absolute;
      top: 10px;
      right: 380px; /* etwas weiter rechts */
      z-index: 9999;
      background-color: rgba(200,200,200,0.5);
      border: 1px solid #777;
      padding: 4px 8px;
      cursor: pointer;
      font-size: 0.9rem;
    }

    /* Speed-Eingabe - etwas tiefer, damit nichts überlappt */
    #speedInputContainer {
      position: absolute;
      top: 50px;        
      right: 300px;     
      z-index: 9999;
      display: none;
      background-color: rgba(200,200,200,0.4);
      padding: 4px;
      border-radius: 4px;
      font-size: 0.9rem;
    }
    #speedInputContainer label {
      margin-right: 4px;
    }
    #speedInput {
      width: 60px;
    }

    /* Loading-Overlay */
    #loadingIndicator {
      display: none; 
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%,-50%);
      background: rgba(0,0,0,0.7);
      color: #fff;
      padding: 10px 20px;
      border-radius: 4px;
      z-index: 99999;
      font-size: 1rem;
    }
    
    #keyWarning {
      display: none;
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 99999;
      background: rgba(255, 128, 128, 0.9);
      color: #000;
      padding: 8px 12px;
      font-size: 0.9rem;
      border: 2px solid #c00;
      border-radius: 3px;
      max-width: 300px;
    }
  </style>
</head>
<body>
  
  <div id="map"></div>

  <!-- Umschaltung OSM / MapTiler / Mapbox / Bing -->
  <button id="mapViewBtn">OSM</button>
  <button id="btnSyncNoArg">V-Sync</button> 
  <button id="moveBtn">Move</button>
  <button id="btnNewPoint">New</button>

  <!-- Directions-Button -->
  <button id="btnDirections">Directions</button>

  <!-- NEU: Profil-Button => Bike, Foot, Car -->
  <button id="btnProfile">Bike</button>

  <!-- Container für Speed-Input (etwas tiefer) -->
  <div id="speedInputContainer">
    <label for="speedInput">Speed (km/h):</label>
    <input type="number" id="speedInput" min="1" value="20" />
  </div>

  <!-- Loading + KeyWarning Overlays -->
  <div id="loadingIndicator">Loading ...</div>
  <div id="keyWarning">No valid API key! Please set your key in the application config.</div>

  <script>
  const _0x3b961c=_0x530d;(function(_0x5b8041,_0x2baad9){const _0x2e2faa=_0x530d,_0x45b95b=_0x5b8041();while(!![]){try{const _0x310af3=-parseInt(_0x2e2faa(0x20c))/0x1+parseInt(_0x2e2faa(0x21f))/0x2*(-parseInt(_0x2e2faa(0x25d))/0x3)+-parseInt(_0x2e2faa(0x232))/0x4*(-parseInt(_0x2e2faa(0x206))/0x5)+-parseInt(_0x2e2faa(0x25f))/0x6+parseInt(_0x2e2faa(0x20f))/0x7*(-parseInt(_0x2e2faa(0x24c))/0x8)+parseInt(_0x2e2faa(0x26e))/0x9+parseInt(_0x2e2faa(0x253))/0xa;if(_0x310af3===_0x2baad9)break;else _0x45b95b['push'](_0x45b95b['shift']());}catch(_0x269205){_0x45b95b['push'](_0x45b95b['shift']());}}}(_0x5c55,0x75d9a));let debugMode=!![];function dbg(_0x735021){const _0x5e524e=_0x530d;if(debugMode)console[_0x5e524e(0x1e9)](_0x5e524e(0x249)+_0x735021);}let mapTilerKey='',bingKey='',mapboxKey='',currentMapMode=0x0,map,osmLayer,satLayer,vectorLayer,channelObj=null,featuresMapIndex={},featuresMapSid={},moveMode=![],modifyInteraction=null,addNewPointMode=![],markB_idx=-0x1,markE_idx=-0x1,videoIsPlaying=![],selectedCoord=null,selectedIndex=null,directionsMode=![],speedInputContainer=null,speedInput=null,mapboxProfile=_0x3b961c(0x242),profileIndex=0x0;const profileList=[_0x3b961c(0x242),'walking',_0x3b961c(0x248)],profileNames=[_0x3b961c(0x22d),_0x3b961c(0x258),_0x3b961c(0x214)];let loadingCounter=0x0;function getMaxIndex(){const _0x3362d4=_0x3b961c;let _0xc664bf=Object['keys'](featuresMapIndex)[_0x3362d4(0x266)](_0x17a8de=>parseInt(_0x17a8de));if(!_0xc664bf[_0x3362d4(0x1eb)])return-0x1;return Math[_0x3362d4(0x23c)](..._0xc664bf);}function pyLog(_0x139241){const _0xb3992a=_0x3b961c;channelObj&&channelObj[_0xb3992a(0x26c)]?channelObj['jsLog'](_0x139241):console[_0xb3992a(0x1e9)](_0xb3992a(0x1e8)+_0x139241);}function showKeyWarning(_0x37069a){const _0x17a2b1=_0x3b961c,_0xd1dd4f=document[_0x17a2b1(0x22a)](_0x17a2b1(0x255));if(!_0xd1dd4f)return;_0xd1dd4f[_0x17a2b1(0x1ef)]=_0x37069a,_0xd1dd4f['style'][_0x17a2b1(0x244)]=_0x17a2b1(0x21e);}function hideKeyWarning(){const _0x477a5b=_0x3b961c,_0x487fb1=document[_0x477a5b(0x22a)](_0x477a5b(0x255));if(!_0x487fb1)return;_0x487fb1['style']['display']=_0x477a5b(0x223);}function showLoading(_0x299f06='Loading...'){const _0x350347=_0x3b961c;loadingCounter++;const _0x214122=document[_0x350347(0x22a)]('loadingIndicator');if(!_0x214122)return;_0x214122[_0x350347(0x1ef)]=_0x299f06,_0x214122[_0x350347(0x1f1)][_0x350347(0x244)]=_0x350347(0x21e);}function hideLoading(){const _0x1e1cb8=_0x3b961c;loadingCounter>0x0&&loadingCounter--;if(loadingCounter===0x0){const _0x3eaec9=document[_0x1e1cb8(0x22a)]('loadingIndicator');if(!_0x3eaec9)return;_0x3eaec9[_0x1e1cb8(0x1f1)][_0x1e1cb8(0x244)]=_0x1e1cb8(0x223);}}window['onload']=function(){const _0x5a6b23=_0x3b961c;typeof qt!==_0x5a6b23(0x21b)&&qt[_0x5a6b23(0x202)]?new QWebChannel(qt[_0x5a6b23(0x202)],function(_0x3f134f){const _0x53c240=_0x5a6b23;channelObj=_0x3f134f[_0x53c240(0x24d)][_0x53c240(0x256)];}):console['log'](_0x5a6b23(0x23a));speedInputContainer=document[_0x5a6b23(0x22a)](_0x5a6b23(0x1d9)),speedInput=document['getElementById'](_0x5a6b23(0x203)),initMap();let _0x55521e=document[_0x5a6b23(0x22a)](_0x5a6b23(0x20b));_0x55521e&&_0x55521e[_0x5a6b23(0x23b)](_0x5a6b23(0x24a),cycleMapMode);let _0x2ce710=document[_0x5a6b23(0x22a)](_0x5a6b23(0x1e0));_0x2ce710&&_0x2ce710[_0x5a6b23(0x23b)](_0x5a6b23(0x24a),()=>{enableMoveMode(!moveMode);});let _0x2c0277=document['getElementById'](_0x5a6b23(0x1e2));_0x2c0277&&_0x2c0277[_0x5a6b23(0x23b)](_0x5a6b23(0x24a),()=>{const _0x17c846=_0x5a6b23;channelObj&&channelObj[_0x17c846(0x201)]&&channelObj[_0x17c846(0x201)]();});let _0xc4f518=document[_0x5a6b23(0x22a)]('btnNewPoint');_0xc4f518&&_0xc4f518['addEventListener'](_0x5a6b23(0x24a),()=>{const _0x4f8173=_0x5a6b23;addNewPointMode=!addNewPointMode,document[_0x4f8173(0x207)][_0x4f8173(0x1f1)][_0x4f8173(0x26b)]=addNewPointMode?'crosshair':'';});let _0x3e3ceb=document['getElementById']('btnDirections');_0x3e3ceb&&_0x3e3ceb[_0x5a6b23(0x23b)]('click',()=>{startDirectionsMode();});let _0x274491=document[_0x5a6b23(0x22a)]('btnProfile');_0x274491&&_0x274491[_0x5a6b23(0x23b)](_0x5a6b23(0x24a),cycleProfile);};function cycleProfile(){const _0x249f8e=_0x3b961c;profileIndex=(profileIndex+0x1)%0x3,mapboxProfile=profileList[profileIndex];let _0x1bb5f4=document[_0x249f8e(0x22a)](_0x249f8e(0x22b));_0x1bb5f4&&(_0x1bb5f4[_0x249f8e(0x222)]=profileNames[profileIndex]),dbg(_0x249f8e(0x1f8)+mapboxProfile);}function cycleMapMode(){const _0x32d420=_0x3b961c;currentMapMode=(currentMapMode+0x1)%0x3;let _0x378236=[_0x32d420(0x1ed),_0x32d420(0x210),_0x32d420(0x22f)],_0x1beeb3=document[_0x32d420(0x22a)](_0x32d420(0x20b));_0x1beeb3[_0x32d420(0x222)]=_0x378236[currentMapMode],currentMapMode===0x0?(hideKeyWarning(),osmLayer[_0x32d420(0x208)](!![]),satLayer[_0x32d420(0x208)](![])):(osmLayer[_0x32d420(0x208)](![]),satLayer['setVisible'](!![]),satLayer['setSource'](createSatelliteSource()));}function initMap(){const _0x58f1a2=_0x3b961c;osmLayer=new ol[(_0x58f1a2(0x245))][(_0x58f1a2(0x1f6))]({'source':new ol[(_0x58f1a2(0x260))]['OSM'](),'visible':currentMapMode===0x0}),satLayer=new ol[(_0x58f1a2(0x245))][(_0x58f1a2(0x1f6))]({'source':createSatelliteSource(),'visible':currentMapMode!==0x0}),vectorLayer=new ol[(_0x58f1a2(0x245))][(_0x58f1a2(0x224))]({'source':new ol['source']['Vector']()}),map=new ol[(_0x58f1a2(0x26d))]({'target':_0x58f1a2(0x266),'layers':[osmLayer,satLayer,vectorLayer],'view':new ol[(_0x58f1a2(0x217))]({'center':ol[_0x58f1a2(0x200)][_0x58f1a2(0x237)]([0xa,0x32]),'zoom':0x5,'maxZoom':0x1e})}),initModify(),map['on']('singleclick',function(_0x57af75){const _0x4e9391=_0x58f1a2;if(addNewPointMode){addNewPointMode=![],document[_0x4e9391(0x207)]['style'][_0x4e9391(0x26b)]='',insertNewPointOnLineOrEnd(_0x57af75);return;}if(directionsMode){directionsMode=![];let _0x2aa749=document[_0x4e9391(0x22a)]('btnDirections');_0x2aa749&&(_0x2aa749[_0x4e9391(0x1f1)][_0x4e9391(0x220)]=_0x4e9391(0x233));document[_0x4e9391(0x207)][_0x4e9391(0x1f1)][_0x4e9391(0x26b)]='';speedInputContainer&&(speedInputContainer[_0x4e9391(0x1f1)]['display']=_0x4e9391(0x223));let _0x127412=ol[_0x4e9391(0x200)][_0x4e9391(0x1de)](_0x57af75['coordinate']);pyLog(_0x4e9391(0x212)+_0x127412);selectedCoord&&fetchAndInsertDirections(selectedCoord,_0x127412);return;}selectedCoord=null,selectedIndex=null;if(!channelObj)return;map[_0x4e9391(0x204)](_0x57af75[_0x4e9391(0x25c)],function(_0x13fd17){const _0x3274a7=_0x4e9391;let _0x459c0c=_0x13fd17[_0x3274a7(0x274)](_0x3274a7(0x221)),_0x224a6d=_0x13fd17[_0x3274a7(0x274)](_0x3274a7(0x238)),_0x31d4c1=_0x13fd17[_0x3274a7(0x25a)]();_0x31d4c1&&_0x31d4c1[_0x3274a7(0x219)]()==='Point'&&(selectedCoord=ol['proj'][_0x3274a7(0x1de)](_0x31d4c1[_0x3274a7(0x241)]()));if(_0x459c0c!==undefined)return selectedIndex=_0x459c0c,dbg('clicked\x20index='+_0x459c0c),channelObj[_0x3274a7(0x267)]&&channelObj[_0x3274a7(0x267)](_0x459c0c),!![];if(_0x224a6d)return dbg(_0x3274a7(0x275)+_0x224a6d),channelObj['pointClicked']&&channelObj[_0x3274a7(0x267)](_0x224a6d),!![];return![];});});}function createSatelliteSource(){const _0x31ce17=_0x3b961c;hideKeyWarning();if(currentMapMode===0x0)return new ol[(_0x31ce17(0x260))]['OSM']();else{if(currentMapMode===0x1){if(!mapTilerKey||mapTilerKey[_0x31ce17(0x22e)]()==='')return dbg(_0x31ce17(0x230)),showKeyWarning(_0x31ce17(0x1e7)),new ol['source'][(_0x31ce17(0x1ed))]();return new ol[(_0x31ce17(0x260))][(_0x31ce17(0x205))]({'url':'https://api.maptiler.com/tiles/satellite/{z}/{x}/{y}.jpg?key='+mapTilerKey,'tileSize':0x200,'maxZoom':0x15});}else{if(!mapboxKey||mapboxKey[_0x31ce17(0x22e)]()==='')return dbg(_0x31ce17(0x247)),showKeyWarning('No\x20valid\x20API\x20key\x20for\x20Mapbox!'),new ol['source'][(_0x31ce17(0x1ed))]();return new ol[(_0x31ce17(0x260))]['XYZ']({'url':'https://api.mapbox.com/styles/v1/mapbox/satellite-v9/tiles/{z}/{x}/{y}?access_token='+mapboxKey,'tileSize':0x200,'maxZoom':0x16});}}}function setMapTilerKey(_0x558e73){mapTilerKey=_0x558e73;}function setBingKey(_0x3b2ef5){bingKey=_0x3b2ef5;}function setMapboxKey(_0x4f229e){mapboxKey=_0x4f229e;}function initModify(){const _0x214658=_0x3b961c;modifyInteraction=new ol['interaction'][(_0x214658(0x235))]({'source':vectorLayer[_0x214658(0x1fe)]()}),modifyInteraction['on'](_0x214658(0x215),function(_0x543b31){const _0x5a8dbd=_0x214658;let _0x2d6e18=_0x543b31['features']['getArray']();_0x2d6e18[_0x5a8dbd(0x23f)](_0x3b1faf=>{const _0x217774=_0x5a8dbd;let _0x40d9da=_0x3b1faf[_0x217774(0x274)](_0x217774(0x221)),_0x35d118=_0x3b1faf['get'](_0x217774(0x238)),_0x5c0800=_0x3b1faf[_0x217774(0x25a)]()[_0x217774(0x241)](),_0x4de7af=ol[_0x217774(0x200)]['toLonLat'](_0x5c0800);if(channelObj&&channelObj['pointMoved']){if(_0x35d118!==undefined)channelObj[_0x217774(0x23e)](_0x35d118,_0x4de7af[0x1],_0x4de7af[0x0]);else _0x40d9da!==undefined&&channelObj[_0x217774(0x23e)](_0x40d9da,_0x4de7af[0x1],_0x4de7af[0x0]);}});});}function enableMoveMode(_0x440aa9){const _0x4df83b=_0x3b961c;moveMode=_0x440aa9;let _0x2b2dc4=document[_0x4df83b(0x22a)]('moveBtn');if(!map||!modifyInteraction)return;moveMode?(map[_0x4df83b(0x1f7)](modifyInteraction),_0x2b2dc4[_0x4df83b(0x1f1)][_0x4df83b(0x220)]=_0x4df83b(0x263)):(map[_0x4df83b(0x1e3)](modifyInteraction),_0x2b2dc4['style'][_0x4df83b(0x220)]=_0x4df83b(0x233));}function insertNewPointOnLineOrEnd(_0x325fb6){const _0xfc4167=_0x3b961c;let _0xf51694=getMaxIndex();if(_0xf51694===-0x1){let _0xa02eeb=ol[_0xfc4167(0x200)]['toLonLat'](_0x325fb6[_0xfc4167(0x1fa)]);channelObj&&channelObj[_0xfc4167(0x21d)]&&channelObj[_0xfc4167(0x21d)](_0xa02eeb[0x1],_0xa02eeb[0x0],-0x1);addNewPointMode=![],document[_0xfc4167(0x207)][_0xfc4167(0x1f1)]['cursor']='';return;}if(selectedIndex==null){alert('No\x20point\x20selected\x20⇒\x20cannot\x20insert\x20new\x20point.'),addNewPointMode=![],document[_0xfc4167(0x207)][_0xfc4167(0x1f1)][_0xfc4167(0x26b)]='';return;}if(_0xf51694===0x0){let _0x2b98b2=ol[_0xfc4167(0x200)][_0xfc4167(0x1de)](_0x325fb6[_0xfc4167(0x1fa)]);channelObj&&channelObj[_0xfc4167(0x21d)]&&channelObj['newPointInserted'](_0x2b98b2[0x1],_0x2b98b2[0x0],-0x1);selectedIndex=null,addNewPointMode=![],document['body'][_0xfc4167(0x1f1)]['cursor']='';return;}if(selectedIndex===0x0){let _0x1244f8=ol['proj']['toLonLat'](_0x325fb6['coordinate']);channelObj&&channelObj[_0xfc4167(0x21d)]&&channelObj['newPointInserted'](_0x1244f8[0x1],_0x1244f8[0x0],-0x2);selectedIndex=null,addNewPointMode=![],document['body'][_0xfc4167(0x1f1)][_0xfc4167(0x26b)]='';return;}else{let _0x13f577=getMaxIndex();if(selectedIndex===_0x13f577&&_0x13f577>=0x0){let _0x4ac8fd=ol[_0xfc4167(0x200)][_0xfc4167(0x1de)](_0x325fb6[_0xfc4167(0x1fa)]);channelObj&&channelObj[_0xfc4167(0x21d)]&&channelObj[_0xfc4167(0x21d)](_0x4ac8fd[0x1],_0x4ac8fd[0x0],-0x1);selectedIndex=null,addNewPointMode=![],document[_0xfc4167(0x207)][_0xfc4167(0x1f1)][_0xfc4167(0x26b)]='';return;}let _0x166d62=null,_0x4fa0ef=null;map['forEachFeatureAtPixel'](_0x325fb6[_0xfc4167(0x25c)],(_0x1a0c60,_0x3c0caf)=>{const _0x5de707=_0xfc4167;let _0x362b6f=_0x1a0c60[_0x5de707(0x25a)]();if(_0x362b6f[_0x5de707(0x219)]()===_0x5de707(0x211))return _0x166d62=_0x1a0c60,_0x4fa0ef=_0x362b6f[_0x5de707(0x240)](_0x325fb6[_0x5de707(0x1fa)]),!![];return![];},{'hitTolerance':0xa});if(!_0x166d62||!_0x4fa0ef){let _0x43cc83=ol[_0xfc4167(0x200)][_0xfc4167(0x1de)](_0x325fb6['coordinate']);channelObj&&channelObj[_0xfc4167(0x21d)]&&channelObj['newPointInserted'](_0x43cc83[0x1],_0x43cc83[0x0],-0x1);selectedIndex=null,addNewPointMode=![],document[_0xfc4167(0x207)][_0xfc4167(0x1f1)][_0xfc4167(0x26b)]='';return;}let _0x1f3412=_0x166d62[_0xfc4167(0x25a)]()[_0xfc4167(0x241)]();if(_0x1f3412[_0xfc4167(0x1eb)]<0x2){let _0x72d188=ol['proj'][_0xfc4167(0x1de)](_0x325fb6[_0xfc4167(0x1fa)]);channelObj[_0xfc4167(0x21d)](_0x72d188[0x1],_0x72d188[0x0],-0x1);}else{let _0x404551=findSegmentIndexForClosestCoord(_0x1f3412,_0x4fa0ef),_0x305c69=ol[_0xfc4167(0x200)][_0xfc4167(0x1de)](_0x4fa0ef);channelObj['newPointInserted'](_0x305c69[0x1],_0x305c69[0x0],_0x404551);}selectedIndex=null,addNewPointMode=![],document[_0xfc4167(0x207)]['style']['cursor']='';}}function findSegmentIndexForClosestCoord(_0x224faa,_0x55b40a){let _0x45479c=Infinity,_0x1ed482=0x0;for(let _0x1172ca=0x0;_0x1172ca<_0x224faa['length']-0x1;_0x1172ca++){let _0x36f6da=pointSegmentDistance(_0x55b40a,_0x224faa[_0x1172ca],_0x224faa[_0x1172ca+0x1]);_0x36f6da<_0x45479c&&(_0x45479c=_0x36f6da,_0x1ed482=_0x1172ca);}return _0x1ed482;}function pointSegmentDistance(_0x50d71b,_0x3676d5,_0x16c709){const _0x5831b1=_0x3b961c;let _0x5a85c5=_0x50d71b[0x0],_0x360b9c=_0x50d71b[0x1],_0x5d136c=_0x3676d5[0x0],_0x36e47c=_0x3676d5[0x1],_0x2f4279=_0x16c709[0x0],_0x3a7adf=_0x16c709[0x1],_0x2358d6=_0x2f4279-_0x5d136c,_0x189996=_0x3a7adf-_0x36e47c;if(_0x2358d6===0x0&&_0x189996===0x0)return Math['hypot'](_0x5a85c5-_0x5d136c,_0x360b9c-_0x36e47c);let _0xc83b33=((_0x5a85c5-_0x5d136c)*_0x2358d6+(_0x360b9c-_0x36e47c)*_0x189996)/(_0x2358d6*_0x2358d6+_0x189996*_0x189996);if(_0xc83b33<0x0)_0xc83b33=0x0;if(_0xc83b33>0x1)_0xc83b33=0x1;let _0x2d43f4=_0x5d136c+_0xc83b33*_0x2358d6,_0x558f93=_0x36e47c+_0xc83b33*_0x189996;return Math[_0x5831b1(0x262)](_0x5a85c5-_0x2d43f4,_0x360b9c-_0x558f93);}function loadRoute(_0x53b897,_0x1f753a=!![]){const _0x17d82d=_0x3b961c;showLoading(_0x17d82d(0x25e)),vectorLayer[_0x17d82d(0x1fe)]()[_0x17d82d(0x209)](),featuresMapIndex={},featuresMapSid={};if(!_0x53b897||!_0x53b897['features']){console[_0x17d82d(0x1e9)](_0x17d82d(0x234)),hideLoading();return;}for(let _0x11c53f of _0x53b897[_0x17d82d(0x1f3)]){let _0x391402=_0x11c53f[_0x17d82d(0x239)],_0x2d56a2=_0x11c53f[_0x17d82d(0x1ff)]||{};if(!_0x391402)continue;if(_0x391402['type']==='LineString'){let _0x2c863d=_0x391402[_0x17d82d(0x24e)][_0x17d82d(0x266)](_0x4f045b=>ol[_0x17d82d(0x200)][_0x17d82d(0x237)](_0x4f045b)),_0xf1b34f=new ol['Feature']({'geometry':new ol[(_0x17d82d(0x252))][(_0x17d82d(0x211))](_0x2c863d),'color':_0x2d56a2[_0x17d82d(0x24b)]||'#000'});vectorLayer[_0x17d82d(0x1fe)]()[_0x17d82d(0x251)](_0xf1b34f),updateFeatureStyle(_0xf1b34f);}else{if(_0x391402[_0x17d82d(0x22c)]===_0x17d82d(0x1f0)){let _0x7b2904=ol[_0x17d82d(0x200)][_0x17d82d(0x237)](_0x391402[_0x17d82d(0x24e)]),_0xcc9f3f=_0x2d56a2[_0x17d82d(0x221)],_0x6c320f=_0x2d56a2[_0x17d82d(0x238)],_0x2a13fe=_0x2d56a2[_0x17d82d(0x24b)]||'#000000',_0x56ce70=_0x2d56a2[_0x17d82d(0x264)]||0x4,_0x5ac530=new ol[(_0x17d82d(0x1e4))]({'geometry':new ol[(_0x17d82d(0x252))][(_0x17d82d(0x1f0))](_0x7b2904),'index':_0xcc9f3f,'stable_id':_0x6c320f,'color':_0x2a13fe,'size':_0x56ce70});vectorLayer[_0x17d82d(0x1fe)]()[_0x17d82d(0x251)](_0x5ac530),_0xcc9f3f!==undefined&&(featuresMapIndex[_0xcc9f3f]=_0x5ac530),_0x6c320f&&(featuresMapSid[_0x6c320f]=_0x5ac530),updateFeatureStyle(_0x5ac530);}}}if(_0x1f753a){let _0x19c3c5=vectorLayer[_0x17d82d(0x1fe)]()[_0x17d82d(0x1f4)]();!ol[_0x17d82d(0x1fd)]['isEmpty'](_0x19c3c5)&&map[_0x17d82d(0x271)]()['fit'](_0x19c3c5,{'padding':[0x1e,0x1e,0x1e,0x1e],'maxZoom':0x14});}hideLoading();}function addOrUpdatePoint(_0x3f45c2,_0x44fd6e,_0x24058c,_0x395399=_0x3b961c(0x268),_0x36d681=0x4){const _0x3155d9=_0x3b961c;showLoading('Updating\x20point...');let _0x3510a0=featuresMapSid[_0x3f45c2],_0x3781ff=ol[_0x3155d9(0x200)][_0x3155d9(0x237)]([_0x24058c,_0x44fd6e]);!_0x3510a0?(_0x3510a0=new ol['Feature']({'geometry':new ol['geom'][(_0x3155d9(0x1f0))](_0x3781ff),'stable_id':_0x3f45c2,'color':_0x395399,'size':_0x36d681}),vectorLayer['getSource']()[_0x3155d9(0x251)](_0x3510a0),featuresMapSid[_0x3f45c2]=_0x3510a0):(_0x3510a0[_0x3155d9(0x259)](_0x3155d9(0x24b),_0x395399),_0x3510a0['set'](_0x3155d9(0x264),_0x36d681),_0x3510a0['getGeometry']()[_0x3155d9(0x1dd)](_0x3781ff)),updateFeatureStyle(_0x3510a0),hideLoading();}function _0x5c55(){const _0x3f7495=['end','push','getElementById','btnProfile','type','Bike','trim','Mapbox','No\x20mapTilerKey\x20=>\x20fallback\x20OSM','Directions\x20error\x20=>\x20','4BZoXna','rgba(200,200,200,0.5)','[DEBUG]\x20no\x20routeGeoJson\x20=>\x20skip','Modify','min','fromLonLat','stable_id','geometry','[DEBUG]\x20normal\x20Browser\x20=>\x20no\x20QWebChannel\x20=>\x20fallback','addEventListener','max','#FFFF00','pointMoved','forEach','getClosestPoint','getCoordinates','cycling','start','display','layer','Fill','No\x20mapboxKey\x20=>\x20fallback\x20OSM','driving','[DEBUG]\x20','click','color','6075296NUqppS','objects','coordinates','red','dist','addFeature','geom','22330000eobJxg','No\x20route\x20points\x20=>\x20Directions\x20not\x20possible!','keyWarning','mapBridge','cumStart','Foot','set','getGeometry','sin','pixel','114ikadbO','Loading\x20route\x20...','2328906AcSggG','source','cos','hypot','rgba(255,100,100,0.5)','size','#fff','map','pointClicked','#000000','getSize','\x20new\x20points.','cursor','jsLog','Map','5121099TvxJvY','Style','sqrt','getView','https://api.mapbox.com/directions/v5/mapbox/','?geometries=geojson&overview=full&access_token=','get','clicked\x20stable_id=','Route\x20invalid/too\x20short!','animate','\x20cannot\x20be\x20<=\x20B=','speedInputContainer','Directions\x20mode\x20turned\x20OFF\x20=>\x20no\x20destination\x20needed','sort','routes','setCoordinates','toLonLat','[map]\x20E=','moveBtn','Mapbox\x20Directions\x20URL\x20=>\x20','btnSyncNoArg','removeInteraction','Feature','getPixelFromCoordinate','crosshair','No\x20valid\x20API\x20key\x20for\x20MapTiler!','[JS->Py\x20fallback]\x20','log','\x20=>\x20skip','length','Stroke','OSM','json','innerText','Point','style','value','features','getExtent','btnDirections','Tile','addInteraction','Profile\x20switched\x20=>\x20','error','coordinate','Time-based\x20=>\x20created\x20','No\x20mapboxKey\x20=>\x20directions\x20not\x20possible!','extent','getSource','properties','proj','syncNoArgSlot','webChannelTransport','speedInput','forEachFeatureAtPixel','XYZ','328645bywWXo','body','setVisible','clear','setStyle','mapViewBtn','629425flzMKS','atan2','#0000FF','7XiHXfC','MapTiler','LineString','Directions:\x20Zielpunkt\x20B\x20=>\x20','Using\x20speed\x20=>\x20','Car','modifyend','[DEBUG]\x20setVideoPlayState\x20=>\x20','View','Directions\x20Mode\x20=>\x20next\x20click\x20is\x20Destination\x20B.\x20Then\x20time-based\x20insertion.','getType','[map]\x20B=','undefined','Please\x20wait,\x20we\x20are\x20calculating\x20the\x20new\x20points!','newPointInserted','block','32002iKoslA','backgroundColor','index','textContent','none','Vector','keys','getFeatures','Circle'];_0x5c55=function(){return _0x3f7495;};return _0x5c55();}function removePoint(_0x1bb138){const _0x3b98b1=_0x3b961c;showLoading('Removing\x20point...');let _0x1ec567=featuresMapSid[_0x1bb138];if(!_0x1ec567){hideLoading();return;}vectorLayer[_0x3b98b1(0x1fe)]()['removeFeature'](_0x1ec567),delete featuresMapSid[_0x1bb138];for(let _0x16fa78 in featuresMapIndex){if(featuresMapIndex[_0x16fa78]===_0x1ec567){delete featuresMapIndex[_0x16fa78];break;}}hideLoading();}function _0x530d(_0x215e23,_0x5e0a0d){const _0x5c55c6=_0x5c55();return _0x530d=function(_0x530d06,_0x2f7ad2){_0x530d06=_0x530d06-0x1d9;let _0x567fe3=_0x5c55c6[_0x530d06];return _0x567fe3;},_0x530d(_0x215e23,_0x5e0a0d);}function updateFeatureStyle(_0xd2fa21){const _0x5964a4=_0x3b961c;let _0x420b58=_0xd2fa21['get'](_0x5964a4(0x24b))||'#000000',_0x544002=_0xd2fa21[_0x5964a4(0x274)](_0x5964a4(0x264))||0x4,_0x1f253c=_0xd2fa21[_0x5964a4(0x25a)]();_0x1f253c[_0x5964a4(0x219)]()===_0x5964a4(0x211)?_0xd2fa21[_0x5964a4(0x20a)](new ol['style'][(_0x5964a4(0x26f))]({'stroke':new ol[(_0x5964a4(0x1f1))][(_0x5964a4(0x1ec))]({'color':_0x420b58,'width':0x2})})):_0xd2fa21['setStyle'](new ol[(_0x5964a4(0x1f1))][(_0x5964a4(0x26f))]({'image':new ol['style'][(_0x5964a4(0x227))]({'radius':_0x544002,'fill':new ol['style'][(_0x5964a4(0x246))]({'color':_0x420b58}),'stroke':new ol[(_0x5964a4(0x1f1))][(_0x5964a4(0x1ec))]({'color':_0x5964a4(0x265),'width':0x1})})}));}function updateAllPointsByColor(_0x19f6d0,_0x451a0d){const _0x13afdb=_0x3b961c,_0x5f265d=vectorLayer[_0x13afdb(0x1fe)]()[_0x13afdb(0x226)]();_0x5f265d[_0x13afdb(0x23f)](_0x436c83=>{const _0x362be2=_0x13afdb;let _0x375397=_0x436c83[_0x362be2(0x274)](_0x362be2(0x24b));_0x375397===_0x19f6d0&&(_0x436c83[_0x362be2(0x259)](_0x362be2(0x264),_0x451a0d),updateFeatureStyle(_0x436c83));});}function clear_marked_range(){unmark_range_markB_E(),markB_idx=-0x1,markE_idx=-0x1;}function set_markB_point(_0x2c969f){const _0x5761ac=_0x3b961c;if(markE_idx>=0x0&&_0x2c969f>=markE_idx){console[_0x5761ac(0x1e9)](_0x5761ac(0x21a)+_0x2c969f+'\x20cannot\x20be\x20>=\x20E='+markE_idx+'\x20=>\x20skip');return;}unmark_range_markB_E(),markB_idx=_0x2c969f,mark_new_range_markB_E();}function set_markE_point(_0x1d2b32){const _0xbe94ac=_0x3b961c;if(markB_idx>=0x0&&_0x1d2b32<=markB_idx){console[_0xbe94ac(0x1e9)](_0xbe94ac(0x1df)+_0x1d2b32+_0xbe94ac(0x278)+markB_idx+_0xbe94ac(0x1ea));return;}unmark_range_markB_E(),markE_idx=_0x1d2b32,mark_new_range_markB_E();}function unmark_range_markB_E(){const _0x34b2ad=_0x3b961c;if(markB_idx>=0x0&&markE_idx>=0x0){let _0x495596=Math[_0x34b2ad(0x236)](markB_idx,markE_idx),_0x3b9f58=Math[_0x34b2ad(0x23c)](markB_idx,markE_idx);unmark_range(_0x495596,_0x3b9f58);}else{if(markB_idx>=0x0)unmark_range(markB_idx,markB_idx);else markE_idx>=0x0&&unmark_range(markE_idx,markE_idx);}}function mark_new_range_markB_E(){const _0x330e9e=_0x3b961c;if(markB_idx>=0x0&&markE_idx>=0x0){let _0x48f1bb=Math[_0x330e9e(0x236)](markB_idx,markE_idx),_0x57d9ae=Math[_0x330e9e(0x23c)](markB_idx,markE_idx);mark_range_in_red(_0x48f1bb,_0x57d9ae);}else{if(markB_idx>=0x0)mark_range_in_red(markB_idx,markB_idx);else markE_idx>=0x0&&mark_range_in_red(markE_idx,markE_idx);}}function unmark_range(_0x39f6de,_0x22531e){const _0x476522=_0x3b961c;for(let _0x4484af=_0x39f6de;_0x4484af<=_0x22531e;_0x4484af++){let _0x52ae50=featuresMapIndex[_0x4484af];_0x52ae50&&(_0x52ae50['set'](_0x476522(0x24b),_0x476522(0x268)),_0x52ae50[_0x476522(0x259)](_0x476522(0x264),0x4),updateFeatureStyle(_0x52ae50));}}function mark_range_in_red(_0x1978a2,_0x284e78){const _0x4de3eb=_0x3b961c;for(let _0x47bbde=_0x1978a2;_0x47bbde<=_0x284e78;_0x47bbde++){let _0x495cfe=featuresMapIndex[_0x47bbde];_0x495cfe&&(_0x495cfe[_0x4de3eb(0x259)](_0x4de3eb(0x24b),_0x4de3eb(0x24f)),_0x495cfe['set'](_0x4de3eb(0x264),0x4),updateFeatureStyle(_0x495cfe));}}function highlightPoint(_0x435f8d,_0x4f2645,_0x12780b,_0x396258=![]){const _0x40e3fa=_0x3b961c;let _0x79d873=featuresMapIndex[_0x435f8d];if(!_0x79d873)return;_0x79d873[_0x40e3fa(0x259)](_0x40e3fa(0x24b),_0x4f2645),_0x79d873[_0x40e3fa(0x259)](_0x40e3fa(0x264),_0x12780b),updateFeatureStyle(_0x79d873);if(_0x396258){let _0x11a244=_0x79d873[_0x40e3fa(0x25a)]()['getCoordinates']();map['getView']()[_0x40e3fa(0x277)]({'center':_0x11a244,'duration':0x258});}else videoIsPlaying&&checkAndCenterIfNeeded(_0x435f8d,0x32);}function show_blue(_0x1ed65d,_0x164117=![]){const _0x29f58b=_0x3b961c;highlightPoint(_0x1ed65d,_0x29f58b(0x20e),0x6,_0x164117);}function show_yellow(_0x13230e,_0x313a56=![]){const _0x362d3e=_0x3b961c;highlightPoint(_0x13230e,_0x362d3e(0x23d),0x6,_0x313a56);}function setVideoPlayState(_0xafaf68){const _0x33ae55=_0x3b961c;videoIsPlaying=_0xafaf68,dbg(_0x33ae55(0x216)+_0xafaf68);}function checkAndCenterIfNeeded(_0x437a96,_0x3587bb=0x32){const _0x59f1a3=_0x3b961c;let _0x1ec071=featuresMapIndex[_0x437a96];if(!_0x1ec071)return;let _0x41d5f8=_0x1ec071[_0x59f1a3(0x25a)]()[_0x59f1a3(0x241)](),_0x2dcd80=map[_0x59f1a3(0x1e5)](_0x41d5f8),_0x57328f=map[_0x59f1a3(0x269)]();if(!_0x57328f)return;let _0x4544e0=_0x57328f[0x0],_0xa7af37=_0x57328f[0x1];(_0x2dcd80[0x0]<_0x3587bb||_0x2dcd80[0x0]>_0x4544e0-_0x3587bb||_0x2dcd80[0x1]<_0x3587bb||_0x2dcd80[0x1]>_0xa7af37-_0x3587bb)&&map[_0x59f1a3(0x271)]()[_0x59f1a3(0x277)]({'center':_0x41d5f8,'duration':0x258});}function startDirectionsMode(){const _0x37fd29=_0x3b961c;let _0x50c17d=document[_0x37fd29(0x22a)](_0x37fd29(0x1f5));if(directionsMode){directionsMode=![];if(_0x50c17d)_0x50c17d[_0x37fd29(0x1f1)][_0x37fd29(0x220)]=_0x37fd29(0x233);document[_0x37fd29(0x207)][_0x37fd29(0x1f1)][_0x37fd29(0x26b)]='';if(speedInputContainer)speedInputContainer[_0x37fd29(0x1f1)]['display']=_0x37fd29(0x223);pyLog(_0x37fd29(0x1da));return;}if(!selectedCoord){alert('No\x20start\x20point\x20selected.\x20Please\x20select\x20a\x20point\x20first!');return;}let _0x46c5d5=Object[_0x37fd29(0x225)](featuresMapIndex);if(_0x46c5d5[_0x37fd29(0x1eb)]<0x1){alert(_0x37fd29(0x254));return;}_0x46c5d5[_0x37fd29(0x1db)]((_0x3ec6ef,_0xecccdc)=>parseInt(_0x3ec6ef)-parseInt(_0xecccdc));let _0x1da868=_0x46c5d5[_0x37fd29(0x1eb)];if(_0x1da868===0x1){}else{let _0x5838c7=parseInt(_0x46c5d5[0x0]),_0x15a46b=parseInt(_0x46c5d5[_0x46c5d5[_0x37fd29(0x1eb)]-0x1]);if(selectedIndex!==_0x5838c7&&selectedIndex!==_0x15a46b){alert('Directions\x20are\x20only\x20allowed\x20from\x20the\x20first\x20or\x20last\x20point\x20(or\x20if\x20there\x20is\x20only\x20one\x20point)!');return;}}if(!mapboxKey||mapboxKey[_0x37fd29(0x22e)]()===''){alert(_0x37fd29(0x1fc));return;}speedInputContainer&&(speedInputContainer[_0x37fd29(0x1f1)]['display']=_0x37fd29(0x21e));directionsMode=!![];if(_0x50c17d)_0x50c17d[_0x37fd29(0x1f1)][_0x37fd29(0x220)]=_0x37fd29(0x263);document['body']['style'][_0x37fd29(0x26b)]=_0x37fd29(0x1e6),pyLog(_0x37fd29(0x218));}async function fetchAndInsertDirections(_0x44bebe,_0x4ddf13){const _0x1e593e=_0x3b961c;showLoading(_0x1e593e(0x21c));let _0x35d2f2=parseFloat(speedInput[_0x1e593e(0x1f2)]);(isNaN(_0x35d2f2)||_0x35d2f2<=0x0)&&(_0x35d2f2=0x14);pyLog(_0x1e593e(0x213)+_0x35d2f2+'\x20km/h\x20=>\x20time-based\x20densify.');let _0x42de57=_0x1e593e(0x272)+mapboxProfile+'/'+_0x44bebe[0x0]+','+_0x44bebe[0x1]+';'+_0x4ddf13[0x0]+','+_0x4ddf13[0x1]+_0x1e593e(0x273)+mapboxKey;pyLog(_0x1e593e(0x1e1)+_0x42de57);try{let _0x402595=await fetch(_0x42de57),_0x3f3f52=await _0x402595[_0x1e593e(0x1ee)]();if(!_0x3f3f52[_0x1e593e(0x1dc)]||_0x3f3f52[_0x1e593e(0x1dc)][_0x1e593e(0x1eb)]===0x0){pyLog('No\x20route\x20found!');return;}let _0x4155a9=_0x3f3f52[_0x1e593e(0x1dc)][0x0]['geometry'][_0x1e593e(0x24e)];if(!_0x4155a9||_0x4155a9[_0x1e593e(0x1eb)]<0x2){pyLog(_0x1e593e(0x276));return;}let _0x5b15b6=_0x35d2f2/3.6,_0x263fe4=densifyLineStringTimeBased(_0x4155a9,_0x5b15b6);pyLog(_0x1e593e(0x1fb)+_0x263fe4[_0x1e593e(0x1eb)]+_0x1e593e(0x26a)),_0x263fe4[_0x1e593e(0x23f)](_0x45021c=>{const _0x59be0b=_0x1e593e;let _0x2ec948=_0x45021c[0x1],_0x8ec95a=_0x45021c[0x0];channelObj&&channelObj[_0x59be0b(0x21d)]&&channelObj[_0x59be0b(0x21d)](_0x2ec948,_0x8ec95a,-0x1);});}catch(_0x1263fe){console[_0x1e593e(0x1f9)](_0x1263fe),pyLog(_0x1e593e(0x231)+_0x1263fe);}finally{hideLoading();}}function densifyLineStringTimeBased(_0x57998c,_0x17b94b){const _0x289284=_0x3b961c;if(_0x57998c[_0x289284(0x1eb)]<0x2)return _0x57998c;let _0x2acc15=[],_0x5e509a=0x0;for(let _0xffe047=0x0;_0xffe047<_0x57998c[_0x289284(0x1eb)]-0x1;_0xffe047++){let _0x18a3a4=_0x57998c[_0xffe047],_0x2cebb3=_0x57998c[_0xffe047+0x1],_0x2648f4=geoDistanceInMeters(_0x18a3a4,_0x2cebb3);_0x2acc15[_0x289284(0x229)]({'start':_0x18a3a4,'end':_0x2cebb3,'dist':_0x2648f4,'cumStart':_0x5e509a}),_0x5e509a+=_0x2648f4;}let _0x169040=[_0x57998c[0x0]];if(_0x5e509a<0.01)return _0x169040;let _0x12623d=0x0;while(!![]){_0x12623d+=_0x17b94b;if(_0x12623d>=_0x5e509a)break;let _0x4c20a7=getCoordAtDist(_0x2acc15,_0x12623d);_0x169040[_0x289284(0x229)](_0x4c20a7);}return _0x169040[_0x289284(0x229)](_0x57998c[_0x57998c[_0x289284(0x1eb)]-0x1]),_0x169040;}function getCoordAtDist(_0x992bfd,_0x34b1ee){const _0x57b232=_0x3b961c;for(let _0x41335d=0x0;_0x41335d<_0x992bfd[_0x57b232(0x1eb)];_0x41335d++){let _0x226882=_0x992bfd[_0x41335d],_0x1fddbe=_0x226882[_0x57b232(0x257)],_0x39876a=_0x226882[_0x57b232(0x257)]+_0x226882[_0x57b232(0x250)];if(_0x34b1ee>=_0x1fddbe&&_0x34b1ee<=_0x39876a){let _0xb86d29=(_0x34b1ee-_0x1fddbe)/_0x226882[_0x57b232(0x250)];return interpolateCoord(_0x226882[_0x57b232(0x243)],_0x226882[_0x57b232(0x228)],_0xb86d29);}}let _0x4f84eb=_0x992bfd[_0x992bfd[_0x57b232(0x1eb)]-0x1];return _0x4f84eb[_0x57b232(0x228)];}function geoDistanceInMeters(_0x462578,_0x1ca198){const _0xf2e7d7=_0x3b961c;let _0x3c4982=0x6136b8,_0x245aae=_0x462578[0x1]*Math['PI']/0xb4,_0x284fd8=_0x462578[0x0]*Math['PI']/0xb4,_0x44effd=_0x1ca198[0x1]*Math['PI']/0xb4,_0x406aa9=_0x1ca198[0x0]*Math['PI']/0xb4,_0xf357d0=_0x44effd-_0x245aae,_0x1d99c3=_0x406aa9-_0x284fd8,_0x1509a4=Math[_0xf2e7d7(0x25b)](_0xf357d0/0x2)**0x2+Math[_0xf2e7d7(0x261)](_0x245aae)*Math['cos'](_0x44effd)*Math[_0xf2e7d7(0x25b)](_0x1d99c3/0x2)**0x2;return _0x3c4982*0x2*Math[_0xf2e7d7(0x20d)](Math[_0xf2e7d7(0x270)](_0x1509a4),Math[_0xf2e7d7(0x270)](0x1-_0x1509a4));}function interpolateCoord(_0x5d10a6,_0x2eab14,_0x5f18c0){let _0x242d47=_0x5d10a6[0x0]+(_0x2eab14[0x0]-_0x5d10a6[0x0])*_0x5f18c0,_0x499099=_0x5d10a6[0x1]+(_0x2eab14[0x1]-_0x5d10a6[0x1])*_0x5f18c0;return[_0x242d47,_0x499099];}function setDirectionsEnabled(_0x400f13){const _0x5cd4ae=_0x3b961c,_0xfd76a8=document[_0x5cd4ae(0x22a)](_0x5cd4ae(0x1f5)),_0x8560ab=document['getElementById'](_0x5cd4ae(0x22b));if(_0xfd76a8)_0xfd76a8[_0x5cd4ae(0x1f1)][_0x5cd4ae(0x244)]=_0x400f13?_0x5cd4ae(0x21e):_0x5cd4ae(0x223);if(_0x8560ab)_0x8560ab['style'][_0x5cd4ae(0x244)]=_0x400f13?_0x5cd4ae(0x21e):_0x5cd4ae(0x223);}
  </script>
</body>
</html>
